# Лента новостей социальной сети

**Цель:** В результате выполнения ДЗ вы создадите ленту новостей социальной сети

В данном задании тренируются навыки:

- работа с кешами;
- работа с очередями;
- проектирование масштабируемых архитектур.

## Описание/Пошаговая инструкция выполнения домашнего задания:
Разработать ленту новостей. Добавить функционал "добавление поста". Создается отдельная страница, куда пишутся все 
обновления друзей. Для этого нужно хранить подписчиков. Лента формируется на уровне кешей. Формирование ленты производить 
через постановку задачи в очередь на часть подписчиков, чтобы избежать эффекта леди Гаги. В ленте держать последние 1000 
обновлений друзей. Лента должна кешироваться.

ДЗ сдается в виде ссылки на гитлаб и демонстрации работающего проекта, развернутого в интернете.

**Требования:**

- Верно работает инвалидация кеша.
- Обновление лент работает через очередь.
- Есть возможность перестройки кешей из СУБД.

## Реализация

### Общее описание

Добавлена страница с лентой новостей - http://127.0.0.1/news . На данной странице есть возможность:
- добавить новость
- просмотреть новости опубликованные друзьями (обновление ленты происходит только при обновлении страницы)

### Как реализовано

1. Добавлена новая сущность в модель - новость. Новость имеет содержание, автора и время публикации.
2. Подключен брокер сообщений RabbitMQ для возможности подписания на новости друзей
   1. при старте приложение создает общий exchange для всех публикуемых новостей
   2. при авторизации пользователя для каждой сессии создается свой канал для брокера сообщений + очередь с биндингами по идентификаторам друзей
   3. при закрытии сессии на веб-сервисе канал закрывается и очередь удаляется (таким образом кол-во очередей = кол-во активных сессий пользователей)
3. Добавлен бин с кэшированием по метода получения ленты новостей для пользователя (ключ - идентификатор авторизованного пользователя)
   1. при авторизации кэш заполняется послденими 1000 новостей из БД, опубликованными его друзьями
   2. при получении события о публикации новости из брокера сообщений - эта новость пополняет кэш (таким образом чтение из БД выполняется только разово при прогревании кэша - далее при активной сессии лента заполняется из брокера сообщений)
   3. кэш инвалидируется при завершении сессии (можно так же настроить инвалилацию по времени/размеру)
4. Добавлена страница с выводом списка новостей опбуликованных друзьями.
   1. сообщения для ленты выгружаются из кэша ленты новостей
   2. для обновления ленты требуется обновление страницы
5. Добавлено поле для публикации собственной новости
   1. при добавлении новости она сохраняется в БД + публикуется в общий exchange для новостей

### Запуск

Для локального запуска можно использовать [docker-compose](docker-compose.yml)

Тк для данного варианта развертывания отключена регистрация новых пользователей, то для удобства были заведены 2 клиента,
которые уже  являются друзьями и могут публиковать сообщения друг другу.

Логин/пароли:
- ivanov/1van0v09238fghw
- petrov/p3tr0vsdjh49vdfw

#### Сервис в интернете

Информацию приложу в чате при передаче ДЗ